<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç»™è´ç¥çš„ç²’å­çˆ±å¿ƒ</title>
  <style>
    :root{
      --card-bg: rgba(10, 10, 14, 0.62);
      --card-border: rgba(255, 105, 180, 0.25);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.72);
      --btn-bg: rgba(255, 105, 180, 0.16);
      --btn-border: rgba(255, 105, 180, 0.45);
      --shadow: 0 18px 60px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box}
    body {
      margin: 0;
      overflow: hidden;
      background: radial-gradient(1200px 800px at 50% 35%, rgba(255,105,180,.10), rgba(0,0,0,1) 70%);
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", "Noto Sans SC", Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    canvas { display: block; }

    /* èƒŒæ™¯æ°›å›´å±‚ï¼ˆæš—è§’+è½»é›¾ï¼‰ */
    .vignette{
      position: fixed;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(1100px 700px at 50% 35%, rgba(255,105,180,.12), rgba(0,0,0,0) 60%),
        radial-gradient(900px 600px at 30% 20%, rgba(180,120,255,.08), rgba(0,0,0,0) 60%),
        radial-gradient(900px 600px at 70% 25%, rgba(100,200,255,.06), rgba(0,0,0,0) 60%),
        radial-gradient(1200px 900px at 50% 50%, rgba(0,0,0,0), rgba(0,0,0,.86) 72%);
      mix-blend-mode: screen;
    }

    /* æƒ…ä¹¦å¡ç‰‡ */
    .letter-wrap{
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      padding: 18px;
      pointer-events: none;
      z-index: 5;
    }
    .letter{
      width: min(680px, 94vw);
      max-height: min(78vh, 720px);
      overflow: auto;
      color: var(--text);
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 18px 18px 14px;
      pointer-events: auto;
      animation: floatIn .75s ease both;
      position: relative;
    }
    .letter:before{
      content:"";
      position:absolute;
      inset:-1px;
      border-radius: 18px;
      background: radial-gradient(600px 220px at 35% 0%, rgba(255,105,180,.22), rgba(0,0,0,0) 60%);
      pointer-events:none;
      opacity:.85;
    }
    @keyframes floatIn{
      from{opacity:0; transform: translateY(12px) scale(.985)}
      to{opacity:1; transform: translateY(0) scale(1)}
    }
    .letter h1{
      margin: 0 0 8px;
      font-size: 18px;
      letter-spacing: .5px;
      font-weight: 700;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      position: relative;
      z-index: 1;
    }
    .badge{
      font-size: 12px;
      color: rgba(255,255,255,.86);
      padding: 6px 10px;
      border: 1px solid rgba(255,105,180,.35);
      border-radius: 999px;
      background: rgba(255,105,180,.12);
      white-space: nowrap;
      animation: badgePulse 1.8s ease-in-out infinite;
    }
    @keyframes badgePulse{
      0%,100%{transform: translateY(0); box-shadow: 0 0 0 rgba(255,105,180,0)}
      50%{transform: translateY(-1px); box-shadow: 0 0 20px rgba(255,105,180,.20)}
    }
    .letter p{
      margin: 10px 0;
      line-height: 1.72;
      color: var(--muted);
      font-size: 15px;
      position: relative;
      z-index: 1;
      white-space: pre-wrap;
    }
    .sig{
      margin-top: 12px;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
      position: relative;
      z-index: 1;
    }
    .name{
      color: rgba(255,255,255,.88);
      font-size: 15px;
      white-space: nowrap;
    }
    .actions{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content:flex-end;
    }
    .btn{
      appearance: none;
      border: 1px solid var(--btn-border);
      background: var(--btn-bg);
      color: rgba(255,255,255,.92);
      padding: 9px 12px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 14px;
      transition: transform .08s ease, background .2s ease, border-color .2s ease, box-shadow .2s ease;
      user-select: none;
    }
    .btn:hover{
      background: rgba(255,105,180,0.24);
      border-color: rgba(255,105,180,0.70);
      box-shadow: 0 0 22px rgba(255,105,180,.18);
    }
    .btn:active{ transform: scale(.98); }

    .mini{
      font-size: 12px;
      color: rgba(255,255,255,.65);
      margin-top: 10px;
      display:flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      position: relative;
      z-index: 1;
    }

    /* å³ä¸‹è§’æ‰“å¼€æŒ‰é’® */
    .fab{
      position: fixed;
      right: 16px;
      bottom: 16px;
      pointer-events: auto;
      z-index: 9;
    }
    .fab button{
      border-radius: 999px;
      padding: 10px 14px;
      border: 1px solid rgba(255,105,180,.55);
      background: rgba(0,0,0,.25);
      color: rgba(255,255,255,.9);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      box-shadow: 0 12px 40px rgba(0,0,0,.45);
      animation: glow 2.2s ease-in-out infinite;
    }
    @keyframes glow{
      0%,100%{ box-shadow: 0 12px 40px rgba(0,0,0,.45), 0 0 0 rgba(255,105,180,0); }
      50%{ box-shadow: 0 12px 40px rgba(0,0,0,.45), 0 0 26px rgba(255,105,180,.24); }
    }

    .hidden{ display:none !important; }

    /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
    .letter::-webkit-scrollbar{ width: 10px; }
    .letter::-webkit-scrollbar-thumb{
      background: rgba(255,105,180,.25);
      border-radius: 999px;
      border: 2px solid rgba(0,0,0,0);
      background-clip: padding-box;
    }
  </style>
</head>
<body>

<canvas id="heartCanvas"></canvas>
<div class="vignette"></div>

<!-- æƒ…ä¹¦å±‚ -->
<div class="letter-wrap" id="letterWrap">
  <div class="letter" id="letterCard" role="dialog" aria-label="æƒ…ä¹¦">
    <h1>
      <span>ç»™ä½ çš„ä¸€å°å°æƒ…ä¹¦</span>
      <span class="badge">ç‚¹ä¸€ä¸‹å±å¹•ä¼šæœ‰æƒŠå–œ âœ¨</span>
    </h1>

    <!-- ä¸‹é¢è¿™äº› p ä¼šè‡ªåŠ¨æ‰“å­—æœºå‡ºç° -->
    <p class="tw">äº²çˆ±çš„ä½ ï¼š</p>

    <p class="tw">
æˆ‘å‘ç°ä¸€ä»¶äº‹ï¼šè‡ªä»å–œæ¬¢ä¸Šä½ ä»¥åï¼Œæˆ‘çš„æ—¥å­å°±å˜å¾—å¾ˆä¸è®²é“ç†â€”â€”æ˜æ˜åªæ˜¯æƒ³åˆ°ä½ ï¼Œæˆ‘ä¹Ÿä¼šå¿ä¸ä½ç¬‘ï¼›
æ˜æ˜ä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿï¼Œæˆ‘ä¹Ÿä¼šè§‰å¾—å¿ƒé‡Œè½¯è½¯çš„ï¼Œåƒè¢«ä½ è½»è½»æŠ±äº†ä¸€ä¸‹ã€‚
    </p>

    <p class="tw">
æˆ‘çœŸçš„å¾ˆå–œæ¬¢ä½ ã€‚å–œæ¬¢åˆ°æœ‰æ—¶å€™æƒ³è£…ä½œæ·¡å®šéƒ½è£…ä¸å¤ªåƒã€‚ä½ ä¸€è®¤çœŸçœ‹æˆ‘ï¼Œæˆ‘å°±æƒ³æŠŠæ‰€æœ‰å¥½åƒçš„éƒ½åˆ†ç»™ä½ ï¼›
ä½ ä¸€å¯¹æˆ‘æ¸©æŸ”ä¸€ç‚¹ï¼Œæˆ‘å°±ä¼šåœ¨å¿ƒé‡Œå·å·è¯´ï¼šå®Œäº†ï¼Œæ›´å–œæ¬¢äº†ã€‚
    </p>

    <p class="tw">
æ‰€ä»¥æˆ‘æƒ³é—®ä½ ä¸€ä¸ªæœ‰ç‚¹å°å°â€œè´ªå¿ƒâ€çš„è¯·æ±‚ï¼šè¿™ä¸ªå‘¨å…­æˆ–å‘¨æ—¥ï¼Œä½ èƒ½ä¸èƒ½ç•™ä¸€ç‚¹æ—¶é—´ç»™æˆ‘å‘€ï¼Ÿ
ä¸ç”¨å¤šéš†é‡ï¼Œæˆ‘ä»¬å°±è§ä¸€é¢å°±å¥½ã€‚ä¸€èµ·åƒç‚¹ä½ æƒ³åƒçš„ï¼Œèµ°èµ°è·¯ï¼ŒèŠèŠæœ€è¿‘çš„äº‹â€”â€”æˆ–è€…å°±å®‰å®‰é™é™åç€ä¹Ÿè¡Œã€‚
åªè¦æ˜¯å’Œä½ åœ¨ä¸€èµ·ï¼Œæˆ‘å°±ä¼šè§‰å¾—å‘¨æœ«å˜å¾—ç‰¹åˆ«å¯çˆ±ã€‚
    </p>

    <p class="tw">
ä½ ä¸ç”¨æœ‰å‹åŠ›ï¼Œæˆ‘åªæ˜¯å¾ˆè®¤çœŸåœ°å–œæ¬¢ä½ ï¼Œä¹Ÿå¾ˆè®¤çœŸåœ°æƒ³æŠŠè¿™ä»½å–œæ¬¢ï¼Œå˜æˆä½ ç”Ÿæ´»é‡Œèˆ’æœåˆè¸å®çš„é‚£ä¸€éƒ¨åˆ†ã€‚
    </p>

    <div class="sig">
      <div class="name">æƒ³ä½ çš„äººï¼š<span id="fromName">ç‰›æ°¸ç¥¥>niu'y></div>
      <div class="actions">
        <button class="btn" id="pickSat">å‘¨å…­</button>
        <button class="btn" id="pickSun">å‘¨æ—¥</button>
        <button class="btn" id="pickEither">éƒ½å¯ä»¥</button>
        <button class="btn" id="closeLetter">å…ˆæ”¶èµ·æ¥</button>
      </div>
    </div>

    <div class="mini">
      <span id="hint"></span>
      <span id="status"></span>
    </div>
  </div>
</div>

<!-- é‡æ–°æ‰“å¼€ -->
<div class="fab hidden" id="fab">
  <button class="btn" id="openLetter">æ‰“å¼€æƒ…ä¹¦ ğŸ’—</button>
</div>

<script>
  const canvas = document.getElementById('heartCanvas');
  const ctx = canvas.getContext('2d');

  let width, height, dpr;
  let heartParticles = [];
  let stars = [];
  let floatHearts = [];
  let bursts = [];
  let mouse = {x: 0, y: 0};

  function resize() {
    dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    width = canvas.width = Math.floor(window.innerWidth * dpr);
    height = canvas.height = Math.floor(window.innerHeight * dpr);
    canvas.style.width = window.innerWidth + "px";
    canvas.style.height = window.innerHeight + "px";
    ctx.setTransform(1,0,0,1,0,0);
  }

  function rand(a,b){ return a + Math.random()*(b-a); }
  function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

  // çˆ±å¿ƒå‚æ•°æ–¹ç¨‹
  function heartFunction(t) {
    return {
      x: 16 * Math.pow(Math.sin(t), 3),
      y: -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t))
    };
  }

  // èƒŒæ™¯æ˜Ÿæ˜Ÿ
  class Star{
    constructor(){ this.reset(true); }
    reset(initial=false){
      this.x = Math.random() * width;
      this.y = Math.random() * height;
      this.r = rand(0.6, 1.8) * dpr;
      this.vx = rand(-0.02, 0.02) * dpr;
      this.vy = rand(0.01, 0.06) * dpr;
      this.a = rand(0.25, 0.85);
      this.tw = rand(0.8, 2.2);
      if(!initial){ this.y = -20 * dpr; }
    }
    update(t){
      this.x += this.vx;
      this.y += this.vy;
      if(this.x < -20*dpr) this.x = width + 20*dpr;
      if(this.x > width + 20*dpr) this.x = -20*dpr;
      if(this.y > height + 30*dpr) this.reset();
      this.alpha = this.a + Math.sin(t * this.tw + this.x*0.002) * 0.18;
    }
    draw(){
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.r, 0, Math.PI*2);
      ctx.fillStyle = `rgba(255,255,255,${clamp(this.alpha,0.05,0.95)})`;
      ctx.fill();
    }
  }

  // æ¼‚æµ®å°çˆ±å¿ƒï¼ˆçˆ±å¿ƒé›¨ï¼‰
  class FloatHeart{
    constructor(){ this.reset(true); }
    reset(initial=false){
      this.x = Math.random() * width;
      this.y = initial ? Math.random()*height : -40*dpr;
      this.s = rand(6, 16) * dpr;
      this.vy = rand(0.25, 0.75) * dpr;
      this.vx = rand(-0.15, 0.15) * dpr;
      this.rot = rand(0, Math.PI*2);
      this.vr = rand(-0.01, 0.01);
      this.a = rand(0.10, 0.35);
      this.hue = rand(330, 390);
    }
    update(t){
      this.x += this.vx + Math.sin(t*0.8 + this.y*0.002) * 0.12*dpr;
      this.y += this.vy;
      this.rot += this.vr;
      if(this.y > height + 60*dpr) this.reset();
      if(this.x < -60*dpr) this.x = width + 60*dpr;
      if(this.x > width + 60*dpr) this.x = -60*dpr;
    }
    draw(){
      drawMiniHeart(this.x, this.y, this.s, this.rot, `hsla(${this.hue}, 85%, 65%, ${this.a})`);
    }
  }

  function drawMiniHeart(x, y, size, rot, fill){
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(rot);
    ctx.scale(size/32, size/32);
    ctx.beginPath();
    // ä¸€ä¸ªç®€åŒ–çˆ±å¿ƒè·¯å¾„
    ctx.moveTo(0, 10);
    ctx.bezierCurveTo(0, 0, -16, 0, -16, 10);
    ctx.bezierCurveTo(-16, 22, 0, 26, 0, 32);
    ctx.bezierCurveTo(0, 26, 16, 22, 16, 10);
    ctx.bezierCurveTo(16, 0, 0, 0, 0, 10);
    ctx.closePath();
    ctx.fillStyle = fill;
    ctx.shadowBlur = 18 * dpr;
    ctx.shadowColor = fill;
    ctx.fill();
    ctx.restore();
  }

  // ä¸»çˆ±å¿ƒç²’å­
  class HeartParticle {
    constructor() { this.init(); }
    init() {
      const t = Math.random() * Math.PI * 2;
      const pos = heartFunction(t);

      // çˆ±å¿ƒç¼©æ”¾ + å±…ä¸­
      this.ox = (pos.x * 15) * dpr + width / 2;
      this.oy = (pos.y * 15) * dpr + height / 2;

      // åˆå§‹ä»å‘¨å›´é£å…¥ï¼ˆæ›´æµªæ¼«ï¼‰
      const angle = Math.random() * Math.PI * 2;
      const r = rand(80, 240) * dpr;
      this.x = this.ox + Math.cos(angle) * r;
      this.y = this.oy + Math.sin(angle) * r;

      this.vx = rand(-0.12, 0.12) * dpr;
      this.vy = rand(-0.12, 0.12) * dpr;

      this.size = rand(1.2, 3.6) * dpr;
      this.hue = rand(330, 390);
      this.alpha = rand(0.
