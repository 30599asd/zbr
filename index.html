<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç»™ä½ çš„ç²’å­çˆ±å¿ƒ</title>
  <style>
    :root{
      --card-bg: rgba(10, 10, 14, 0.62);
      --card-border: rgba(255, 105, 180, 0.25);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.72);
      --btn-bg: rgba(255, 105, 180, 0.16);
      --btn-border: rgba(255, 105, 180, 0.45);
      --shadow: 0 18px 60px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box}
    body {
      margin: 0;
      overflow: hidden;
      background-color: #000;
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", "Noto Sans SC", Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    canvas { display: block; }

    /* æƒ…ä¹¦å¡ç‰‡ */
    .letter-wrap{
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      padding: 18px;
      pointer-events: none; /* è®© canvas ä»èƒ½æ¥æ”¶äº‹ä»¶ï¼ˆè™½ç„¶æˆ‘ä»¬æ²¡ç”¨åˆ°ï¼‰ */
    }
    .letter{
      width: min(680px, 94vw);
      max-height: min(78vh, 720px);
      overflow: auto;
      color: var(--text);
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 18px 18px 14px;
      pointer-events: auto; /* å¡ç‰‡æœ¬èº«å¯ç‚¹ */
      transform: translateY(0);
      animation: floatIn .7s ease both;
    }
    @keyframes floatIn{
      from{opacity:0; transform: translateY(10px) scale(.99)}
      to{opacity:1; transform: translateY(0) scale(1)}
    }
    .letter h1{
      margin: 0 0 8px;
      font-size: 18px;
      letter-spacing: .5px;
      font-weight: 700;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
    }
    .badge{
      font-size: 12px;
      color: rgba(255,255,255,.8);
      padding: 6px 10px;
      border: 1px solid rgba(255,105,180,.35);
      border-radius: 999px;
      background: rgba(255,105,180,.12);
      white-space: nowrap;
    }
    .letter p{
      margin: 10px 0;
      line-height: 1.72;
      color: var(--muted);
      font-size: 15px;
    }
    .sig{
      margin-top: 12px;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    .name{
      color: rgba(255,255,255,.88);
      font-size: 15px;
      white-space: nowrap;
    }
    .actions{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content:flex-end;
    }
    .btn{
      appearance: none;
      border: 1px solid var(--btn-border);
      background: var(--btn-bg);
      color: rgba(255,255,255,.9);
      padding: 9px 12px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 14px;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      user-select: none;
    }
    .btn:hover{
      background: rgba(255,105,180,0.22);
      border-color: rgba(255,105,180,0.65);
    }
    .btn:active{ transform: scale(.98); }

    .mini{
      font-size: 12px;
      color: rgba(255,255,255,.65);
      margin-top: 10px;
      display:flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    /* å³ä¸‹è§’æ‰“å¼€æŒ‰é’® */
    .fab{
      position: fixed;
      right: 16px;
      bottom: 16px;
      pointer-events: auto;
      z-index: 9;
    }
    .fab button{
      border-radius: 999px;
      padding: 10px 14px;
      border: 1px solid rgba(255,105,180,.55);
      background: rgba(0,0,0,.25);
      color: rgba(255,255,255,.9);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      box-shadow: 0 12px 40px rgba(0,0,0,.45);
    }
    .hidden{ display:none !important; }

    /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ï¼ˆå¯é€‰ï¼‰ */
    .letter::-webkit-scrollbar{ width: 10px; }
    .letter::-webkit-scrollbar-thumb{
      background: rgba(255,105,180,.25);
      border-radius: 999px;
      border: 2px solid rgba(0,0,0,0);
      background-clip: padding-box;
    }
  </style>
</head>
<body>

<canvas id="heartCanvas"></canvas>

<!-- æƒ…ä¹¦å±‚ -->
<div class="letter-wrap" id="letterWrap">
  <div class="letter" id="letterCard" role="dialog" aria-label="æƒ…ä¹¦">
    <h1>
      <span>ç»™ä½ çš„ä¸€å°å°æƒ…ä¹¦</span>
      <span class="badge">ç‚¹ä¸€ä¸‹å°±ä¼šæ›´æƒ³ä½ </span>
    </h1>

    <p>äº²çˆ±çš„ä½ ï¼š</p>

    <p>
      æˆ‘å‘ç°ä¸€ä»¶äº‹ï¼šè‡ªä»å–œæ¬¢ä¸Šä½ ä»¥åï¼Œæˆ‘çš„æ—¥å­å°±å˜å¾—å¾ˆä¸è®²é“ç†â€”â€”æ˜æ˜åªæ˜¯æƒ³åˆ°ä½ ï¼Œæˆ‘ä¹Ÿä¼šå¿ä¸ä½ç¬‘ï¼›
      æ˜æ˜ä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿï¼Œæˆ‘ä¹Ÿä¼šè§‰å¾—å¿ƒé‡Œè½¯è½¯çš„ï¼Œåƒè¢«ä½ è½»è½»æŠ±äº†ä¸€ä¸‹ã€‚
    </p>

    <p>
      æˆ‘çœŸçš„å¾ˆå–œæ¬¢ä½ ã€‚å–œæ¬¢åˆ°æœ‰æ—¶å€™æƒ³è£…ä½œæ·¡å®šéƒ½è£…ä¸å¤ªåƒã€‚ä½ ä¸€è®¤çœŸçœ‹æˆ‘ï¼Œæˆ‘å°±æƒ³æŠŠæ‰€æœ‰å¥½åƒçš„éƒ½åˆ†ç»™ä½ ï¼›
      ä½ ä¸€å¯¹æˆ‘æ¸©æŸ”ä¸€ç‚¹ï¼Œæˆ‘å°±ä¼šåœ¨å¿ƒé‡Œå·å·è¯´ï¼šå®Œäº†ï¼Œæ›´å–œæ¬¢äº†ã€‚
    </p>

    <p>
      æ‰€ä»¥æˆ‘æƒ³é—®ä½ ä¸€ä¸ªæœ‰ç‚¹å°å°â€œè´ªå¿ƒâ€çš„è¯·æ±‚ï¼šè¿™ä¸ªå‘¨å…­æˆ–å‘¨æ—¥ï¼Œä½ èƒ½ä¸èƒ½ç•™ä¸€ç‚¹æ—¶é—´ç»™æˆ‘å‘€ï¼Ÿ
      ä¸ç”¨å¤šéš†é‡ï¼Œæˆ‘ä»¬å°±è§ä¸€é¢å°±å¥½ã€‚ä¸€èµ·åƒç‚¹ä½ æƒ³åƒçš„ï¼Œèµ°èµ°è·¯ï¼ŒèŠèŠæœ€è¿‘çš„äº‹â€”â€”æˆ–è€…å°±å®‰å®‰é™é™åç€ä¹Ÿè¡Œã€‚
      åªè¦æ˜¯å’Œä½ åœ¨ä¸€èµ·ï¼Œæˆ‘å°±ä¼šè§‰å¾—å‘¨æœ«å˜å¾—ç‰¹åˆ«å¯çˆ±ã€‚
    </p>

    <p>
      ä½ ä¸ç”¨æœ‰å‹åŠ›ï¼Œæˆ‘åªæ˜¯å¾ˆè®¤çœŸåœ°å–œæ¬¢ä½ ï¼Œä¹Ÿå¾ˆè®¤çœŸåœ°æƒ³æŠŠè¿™ä»½å–œæ¬¢ï¼Œå˜æˆä½ ç”Ÿæ´»é‡Œèˆ’æœåˆè¸å®çš„é‚£ä¸€éƒ¨åˆ†ã€‚
    </p>

    <div class="sig">
      <div class="name">æƒ³ä½ çš„äººï¼š<span id="fromName">ï¼ˆä½ çš„åå­—ï¼‰</span></div>
      <div class="actions">
        <button class="btn" id="pickSat">å‘¨å…­</button>
        <button class="btn" id="pickSun">å‘¨æ—¥</button>
        <button class="btn" id="pickEither">éƒ½å¯ä»¥</button>
        <button class="btn" id="closeLetter">å…ˆæ”¶èµ·æ¥</button>
      </div>
    </div>

    <div class="mini">
      <span id="hint">å°æç¤ºï¼šå¯ä»¥æŠŠâ€œï¼ˆä½ çš„åå­—ï¼‰â€æ”¹æˆä½ çš„åå­—å†å‘ç»™å¥¹ã€‚</span>
      <span id="status"></span>
    </div>
  </div>
</div>

<!-- é‡æ–°æ‰“å¼€ -->
<div class="fab hidden" id="fab">
  <button class="btn" id="openLetter">æ‰“å¼€æƒ…ä¹¦ ğŸ’—</button>
</div>

<script>
  const canvas = document.getElementById('heartCanvas');
  const ctx = canvas.getContext('2d');

  let width, height;
  let particles = [];

  // çˆ±å¿ƒå½¢çŠ¶çš„å‚æ•°æ–¹ç¨‹
  function heartFunction(t) {
    return {
      x: 16 * Math.pow(Math.sin(t), 3),
      y: -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t))
    };
  }

  function resize() {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
  }

  class Particle {
    constructor() { this.init(); }

    init() {
      let t = Math.random() * Math.PI * 2;
      let pos = heartFunction(t);

      // å°†çˆ±å¿ƒå½¢çŠ¶æ”¾å¤§ï¼Œå¹¶ä½¿å…¶ä½äºå±å¹•ä¸­å¿ƒ
      this.ox = pos.x * 15 + width / 2;
      this.oy = pos.y * 15 + height / 2;

      // ç²’å­çš„åŸå§‹ä½ç½®
      this.x = this.ox;
      this.y = this.oy;

      // ç²’å­çš„é€Ÿåº¦å’Œå¤§å°
      this.vx = (Math.random() - 0.5) * 2;
      this.vy = (Math.random() - 0.5) * 2;
      this.size = Math.random() * 3 + 1;

      // é¢œè‰²ï¼ˆçº¢è‰²åˆ°ç²‰è‰²ï¼‰
      this.hue = Math.random() * 60 + 330; // 330-390 (çº¢è‰²-ç²‰è‰²)
      this.alpha = Math.random() * 0.5 + 0.5;
    }

    update(time) {
      // â€œè·³åŠ¨â€æ•ˆæœ
      let scale = 1 + Math.sin(time * 3) * 0.1;
      this.x = this.ox + (this.x - this.ox) * scale + Math.sin(time * 5 + this.y) * 5;
      this.y = this.oy + (this.y - this.oy) * scale + Math.cos(time * 5 + this.x) * 5;

      // ç²’å­ç¼“æ…¢ç§»åŠ¨
      this.x += this.vx;
      this.y += this.vy;

      // è¾¹ç•Œæ£€æŸ¥
      if (this.x < 0 || this.x > width || this.y < 0 || this.y > height) {
        this.init();
      }
    }

    draw() {
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fillStyle = `hsla(${this.hue}, 80%, 60%, ${this.alpha})`;
      ctx.fill();
    }
  }

  function createParticles() {
    particles = [];
    for (let i = 0; i < 300; i++) {
      particles.push(new Particle());
    }
  }

  function animate() {
    // æ‹–å°¾æ•ˆæœ
    ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
    ctx.fillRect(0, 0, width, height);

    let time = Date.now() * 0.001;
    particles.forEach(p => {
      p.update(time);
      p.draw();
    });

    requestAnimationFrame(animate);
  }

  // åˆå§‹åŒ–åŠ¨ç”»
  window.addEventListener('resize', () => {
    resize();
    createParticles();
  });
  resize();
  createParticles();
  animate();

  // ====== æƒ…ä¹¦äº¤äº’ ======
  const letterWrap = document.getElementById('letterWrap');
  const fab = document.getElementById('fab');
  const status = document.getElementById('status');

  const closeLetter = document.getElementById('closeLetter');
  const openLetter = document.getElementById('openLetter');

  const pickSat = document.getElementById('pickSat');
  const pickSun = document.getElementById('pickSun');
  const pickEither = document.getElementById('pickEither');

  function showStatus(text){
    status.textContent = text;
    status.style.opacity = '1';
    clearTimeout(showStatus._t);
    showStatus._t = setTimeout(() => status.textContent = '', 2400);
  }

  function hideCard(){
    letterWrap.classList.add('hidden');
    fab.classList.remove('hidden');
  }
  function showCard(){
    letterWrap.classList.remove('hidden');
    fab.classList.add('hidden');
  }

  closeLetter.addEventListener('click', hideCard);
  openLetter.addEventListener('click', showCard);

  function copyText(text){
    if (navigator.clipboard && window.isSecureContext) {
      return navigator.clipboard.writeText(text);
    }
    // fallback
    const ta = document.createElement('textarea');
    ta.value = text;
    ta.style.position = 'fixed';
    ta.style.left = '-9999px';
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    ta.remove();
    return Promise.resolve();
  }

  // ç”Ÿæˆä¸€æ¡å¯å¤åˆ¶çš„ä¿¡æ¯ï¼ˆä½ å¯ä»¥æŒ‰éœ€æ”¹ï¼‰
  function buildMsg(choice){
    const from = document.getElementById('fromName').textContent.replace(/[ï¼ˆï¼‰()]/g,'').trim() || 'æˆ‘';
    return `æˆ‘æƒ³è§ä½ ğŸ¥º è¿™å‘¨æœ«ä½ æ›´æ–¹ä¾¿${choice}å—ï¼Ÿæˆ‘æ¥é…åˆä½ ï½ï¼ˆæ¥è‡ªï¼š${from}ï¼‰`;
  }

  pickSat.addEventListener('click', async () => {
    await copyText(buildMsg('å‘¨å…­'));
    showStatus('å·²å¤åˆ¶ï¼šå‘¨å…­ ğŸ’— ç›´æ¥ç²˜è´´å‘ç»™å¥¹å°±è¡Œ');
  });
  pickSun.addEventListener('click', async () => {
    await copyText(buildMsg('å‘¨æ—¥'));
    showStatus('å·²å¤åˆ¶ï¼šå‘¨æ—¥ ğŸ’— ç›´æ¥ç²˜è´´å‘ç»™å¥¹å°±è¡Œ');
  });
  pickEither.addEventListener('click', async () => {
    await copyText(buildMsg('å‘¨å…­æˆ–å‘¨æ—¥éƒ½å¯ä»¥'));
    showStatus('å·²å¤åˆ¶ï¼šéƒ½å¯ä»¥ ğŸ’— ç›´æ¥ç²˜è´´å‘ç»™å¥¹å°±è¡Œ');
  });

  // å…è®¸æŒ‰ ESC æ”¶èµ·æƒ…ä¹¦
  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') hideCard();
  });
</script>

</body>
</html>
