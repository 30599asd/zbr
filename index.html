<!--
 * @Author: Tina Huang
 * @Date: 2022-12-09 21:29:19
 * @LastEditors: Tina Huang
 * @LastEditTime: 2022-12-10 15:35:42
 * @Description:
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Merry Christmas</title>
    <style>
      body {
        background-color: #000;
        overflow: hidden;
      }
      body,
      html {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
      }
      .main {
        width: 100%;
        height: 100%;
        position: relative;
      }
      canvas {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 0;
      }
      .mainSVG {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        overflow: visible;
        z-index: 2;
      }
      #mask {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 72px;
        cursor: pointer;
        user-select: none;
        z-index: 9999;
        background: radial-gradient(
          circle at center,
          rgba(255, 105, 180, 0.12),
          rgba(0, 0, 0, 0.88) 60%,
          rgba(0, 0, 0, 1)
        );
        backdrop-filter: blur(6px);
      }
      #header {
        position: absolute;
        top: 5%;
        width: 100%;
        text-align: center;
        color: rgba(255, 255, 255, 0.92);
        font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue",
          Arial, "Noto Sans", "Liberation Sans", sans-serif;
        z-index: 3;
        letter-spacing: 1px;
      }
      .particle {
        will-change: transform;
      }
    </style>
  </head>

  <body>
    <div id="mask">ğŸ„</div>
    <canvas id="stars"></canvas>

    <div class="main">
      <!-- partial:index.partial.html -->
      <svg
        class="mainSVG"
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        viewBox="0 0 800 600"
      >
        <defs>
          <circle id="circ" class="particle" cx="0" cy="0" r="1" />
          <polygon
            id="star"
            class="particle"
            points="13.1,0 16.6,9.6 26.6,9.6 18.5,15.5 21.7,25.1 13.1,19.2 4.8,25.1 7.8,15.5 0,9.6 9.7,9.6"
          />
          <radialGradient id="grad" cx="0" cy="0" r="50" gradientUnits="userSpaceOnUse">
            <stop offset="0" style="stop-color: #ffffff; stop-opacity: 1" />
            <stop offset="0.3" style="stop-color: #6df; stop-opacity: 0.8" />
            <stop offset="0.6" style="stop-color: hsl(37, 53%, 85%)" />
            <stop offset="0.9" style="stop-color: #fee8c7" />
            <stop offset="1" style="stop-color: red" />
          </radialGradient>

          <radialGradient
            id="dotGrad"
            cx="0"
            cy="0"
            r="50"
            gradientUnits="userSpaceOnUse"
          >
            <stop offset="0" style="stop-color: #ffffff; stop-opacity: 1" />
            <stop offset="0.1" style="stop-color: #0867c7; stop-opacity: 0.6" />
            <stop offset="1" style="stop-color: #081029; stop-opacity: 0" />
          </radialGradient>

          <mask id="treePathMask">
            <path
              class="treePathMask"
              fill="none"
              stroke-width="18"
              stroke="#FFF"
              d="M252.9,447.9c0,0-30.8-21.5-30.8-70.3c0-48.8,22.5-90,22.5-90s8.5-15,8.5-37.5s-9.8-35.5-9.8-35.5s-12.8-20.5-12.8-47.3s22.8-46.5,22.8-46.5s14.3-21.5,14.3-45.3s-11.8-41-11.8-41s-15.3-25.5-15.3-52.8"
            />
          </mask>

          <g id="sparkleGroup">
            <circle class="sparkle" fill="url(#dotGrad)" cx="0" cy="0" r="50" />
          </g>
        </defs>

        <g class="pContainer"></g>

        <g class="treeGroup">
          <path
            class="treePath"
            fill="none"
            stroke="#18e"
            stroke-width="4"
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M252.9,447.9c0,0-30.8-21.5-30.8-70.3c0-48.8,22.5-90,22.5-90s8.5-15,8.5-37.5s-9.8-35.5-9.8-35.5s-12.8-20.5-12.8-47.3s22.8-46.5,22.8-46.5s14.3-21.5,14.3-45.3s-11.8-41-11.8-41s-15.3-25.5-15.3-52.8"
          />
          <path
            class="treePath2"
            fill="none"
            stroke="#f6b"
            stroke-width="5"
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M252.9,447.9c0,0-30.8-21.5-30.8-70.3c0-48.8,22.5-90,22.5-90s8.5-15,8.5-37.5s-9.8-35.5-9.8-35.5s-12.8-20.5-12.8-47.3s22.8-46.5,22.8-46.5s14.3-21.5,14.3-45.3s-11.8-41-11.8-41s-15.3-25.5-15.3-52.8"
          />
        </g>

        <g class="starGroup" mask="url(#treePathMask)">
          <use xlink:href="#sparkleGroup" />
        </g>
      </svg>

      <h1 id="header"></h1>
    </div>

    <!-- âœ… GSAPï¼ˆæ ‡å‡†éè¯•ç”¨ç‰ˆï¼‰ -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.14.2/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.14.2/dist/MotionPathPlugin.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.14.2/dist/DrawSVGPlugin.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.14.2/dist/MorphSVGPlugin.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.14.2/dist/Physics2DPlugin.min.js"></script>

    <script>
      function snow() {
        //  1ã€å®šä¹‰ä¸€ç‰‡é›ªèŠ±æ¨¡æ¿
        var flake = document.createElement("div");
        // é›ªèŠ±å­—ç¬¦ â„â‰â…â†âœ»âœ¼â‡âˆâŠâœ¥âœº
        flake.innerHTML = "â†";
        flake.style.cssText = "position:absolute;color:#fff;";

        //è·å–é¡µé¢çš„é«˜åº¦ ç›¸å½“äºé›ªèŠ±ä¸‹è½ç»“æŸæ—¶Yè½´çš„ä½ç½®
        var documentHieght = window.innerHeight;
        //è·å–é¡µé¢çš„å®½åº¦ï¼Œåˆ©ç”¨è¿™ä¸ªæ•°æ¥ç®—å‡ºï¼Œé›ªèŠ±å¼€å§‹æ—¶leftçš„å€¼
        var documentWidth = window.innerWidth;

        //å®šä¹‰ç”Ÿæˆä¸€ç‰‡é›ªèŠ±çš„æ¯«ç§’æ•°
        var millisec = 100;
        //2ã€è®¾ç½®ç¬¬ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå‘¨æœŸæ€§å®šæ—¶å™¨ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ï¼ˆmillisecï¼‰ç”Ÿæˆä¸€ç‰‡é›ªèŠ±ï¼›
        setInterval(function () {
          //éšæœºç”Ÿæˆé›ªèŠ±ä¸‹è½ å¼€å§‹ æ—¶leftçš„å€¼ï¼Œç›¸å½“äºå¼€å§‹æ—¶Xè½´çš„ä½ç½®
          var startLeft = Math.random() * documentWidth;

          //éšæœºç”Ÿæˆé›ªèŠ±ä¸‹è½ ç»“æŸ æ—¶leftçš„å€¼ï¼Œç›¸å½“äºç»“æŸæ—¶Xè½´çš„ä½ç½®
          var endLeft = Math.random() * documentWidth;

          //éšæœºç”Ÿæˆé›ªèŠ±å¤§å°
          var flakeSize = 5 + 20 * Math.random();

          //éšæœºç”Ÿæˆé›ªèŠ±ä¸‹è½æŒç»­æ—¶é—´
          var durationTime = 4000 + 7000 * Math.random();

          //éšæœºç”Ÿæˆé›ªèŠ±ä¸‹è½ å¼€å§‹ æ—¶çš„é€æ˜åº¦
          var startOpacity = 0.7 + 0.3 * Math.random();

          //éšæœºç”Ÿæˆé›ªèŠ±ä¸‹è½ ç»“æŸ æ—¶çš„é€æ˜åº¦
          var endOpacity = 0.2 + 0.2 * Math.random();

          //å…‹éš†ä¸€ä¸ªé›ªèŠ±æ¨¡æ¿
          var cloneFlake = flake.cloneNode(true);

          //ç¬¬ä¸€æ¬¡ä¿®æ”¹æ ·å¼ï¼Œå®šä¹‰å…‹éš†å‡ºæ¥çš„é›ªèŠ±çš„æ ·å¼
          cloneFlake.style.cssText += `
                left: ${startLeft}px;
                opacity: ${startOpacity};
                font-size: ${flakeSize}px;
                top:-25px;
                transition: ${durationTime}ms;
            `;

          //æ‹¼æ¥åˆ°é¡µé¢ä¸­
          document.body.appendChild(cloneFlake);

          //è®¾ç½®ç¬¬äºŒä¸ªå®šæ—¶å™¨ï¼Œä¸€æ¬¡æ€§å®šæ—¶å™¨ï¼Œ
          //å½“ç¬¬ä¸€ä¸ªå®šæ—¶å™¨ç”Ÿæˆé›ªèŠ±ï¼Œå¹¶åœ¨é¡µé¢ä¸Šæ¸²æŸ“å‡ºæ¥åï¼Œä¿®æ”¹é›ªèŠ±çš„æ ·å¼ï¼Œè®©é›ªèŠ±åŠ¨èµ·æ¥ï¼›
          setTimeout(function () {
            //ç¬¬äºŒæ¬¡ä¿®æ”¹æ ·å¼
            cloneFlake.style.cssText += `
                                left: ${endLeft}px;
                                top:${documentHieght}px;
                                opacity:${endOpacity};
                            `;

            //4ã€è®¾ç½®ç¬¬ä¸‰ä¸ªå®šæ—¶å™¨ï¼Œå½“é›ªèŠ±è½ä¸‹åï¼Œåˆ é™¤é›ªèŠ±ã€‚
            setTimeout(function () {
              cloneFlake.remove();
            }, durationTime);
          }, 0);
        }, millisec);
      }

      snow();
      // GSAP plugins (loaded via CDN above)
      if (window.gsap) {
        gsap.registerPlugin(MorphSVGPlugin, MotionPathPlugin, DrawSVGPlugin, Physics2DPlugin);
      }

      MorphSVGPlugin.convertToPath("polygon");
      var xmlns = "http://www.w3.org/2000/svg",
        xlinkns = "http://www.w3.org/1999/xlink",
        select = function (s) {
          return document.querySelector(s);
        },
        selectAll = function (s) {
          return document.querySelectorAll(s);
        },
        pContainer = select(".pContainer"),
        mainSVG = select(".mainSVG"),
        sparkle = selectAll(".sparkle"),
        treePath = select(".treePath"),
        treePath2 = select(".treePath2"),
        starGroup = select(".starGroup"),
        treeGroup = select(".treeGroup"),
        starTl,
        mainTl = gsap.timeline({ paused: true }),
        particlePool = [],
        numParticles = 100,
        particleCount = 0,
        getScale = gsap.utils.random(0.4, 0.8, 0.1, true),
        mainContainer = select(".main"),
        width = window.innerWidth,
        height = window.innerHeight;

      gsap.set("svg", { visibility: "visible" });

      // header text
      var header = document.getElementById("header");
      header.innerText = "Merry Christmas âœ¨";

      // canvas stars background
      var starsCanvas = document.getElementById("stars");
      var ctxStars = starsCanvas.getContext("2d");
      function resizeCanvas() {
        width = window.innerWidth;
        height = window.innerHeight;
        starsCanvas.width = width;
        starsCanvas.height = height;
      }
      resizeCanvas();
      window.addEventListener("resize", resizeCanvas);

      var bgStars = [];
      function initBgStars() {
        bgStars = [];
        var count = Math.floor((width * height) / 8000);
        for (var i = 0; i < count; i++) {
          bgStars.push({
            x: Math.random() * width,
            y: Math.random() * height,
            r: Math.random() * 1.4 + 0.2,
            a: Math.random() * 0.7 + 0.2,
            tw: Math.random() * 0.02 + 0.005,
          });
        }
      }
      initBgStars();

      function renderBgStars() {
        ctxStars.clearRect(0, 0, width, height);
        ctxStars.beginPath();
        for (var i = 0; i < bgStars.length; i++) {
          var s = bgStars[i];
          s.a += (Math.random() > 0.5 ? 1 : -1) * s.tw;
          s.a = Math.max(0.08, Math.min(0.95, s.a));
          ctxStars.globalAlpha = s.a;
          ctxStars.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        }
        ctxStars.fillStyle = "#fff";
        ctxStars.fill();
        ctxStars.globalAlpha = 1;
        requestAnimationFrame(renderBgStars);
      }
      renderBgStars();

      // create particles (sparkles)
      function createParticles() {
        for (var i = 0; i < numParticles; i++) {
          var p = document.createElementNS(xmlns, "use");
          p.setAttributeNS(xlinkns, "xlink:href", "#circ");
          pContainer.appendChild(p);
          gsap.set(p, { transformOrigin: "50% 50%" });
          var tl = gsap.timeline({ repeat: -1, repeatDelay: Math.random() * 2 });
          tl.to(p, {
            duration: gsap.utils.random(0.61, 6),
            physics2D: {
              velocity: gsap.utils.random(12, 28),
              angle: gsap.utils.random(0, 360),
              gravity: 0,
            },
            scale: getScale(),
            opacity: 1,
            ease: "power2.out",
            onStartParams: [p],
            onStart: function (p) {
              gsap.set(p, {
                x: 252 + gsap.utils.random(-50, 50),
                y: 450 + gsap.utils.random(-10, 10),
              });
            },
          })
            .to(
              p,
              {
                duration: 0.6,
                opacity: 0,
                ease: "power2.in",
              },
              "-=0.3"
            )
            .call(function () {
              // noop
            });
          particlePool.push(tl);
        }
      }

      // åœ£è¯æ ‘å¼€å§‹ç»˜ç”»æ—¶å°å…‰ç‚¹åŠ¨ç”»
      function drawStar() {
        starTl = gsap.timeline({ onUpdate: function () {} });
        gsap.set(sparkle, { scale: 0, transformOrigin: "50% 50%" });

        sparkle.forEach(function (s, i) {
          starTl.to(
            s,
            {
              duration: 0.9,
              scale: gsap.utils.random(0.12, 0.6),
              opacity: gsap.utils.random(0.2, 0.9),
              ease: "sine.inOut",
              repeat: -1,
              yoyo: true,
              repeatDelay: gsap.utils.random(0.05, 0.3),
            },
            i * 0.02
          );
        });
      }

      // main tree draw
      function drawMain() {
        mainTl = gsap.timeline({ paused: true });

        gsap.set([treePath, treePath2], { drawSVG: "0% 0%" });
        mainTl
          .to(treePath, { duration: 2.4, drawSVG: "0% 100%", ease: "power2.inOut" }, 0)
          .to(
            treePath2,
            { duration: 2.6, drawSVG: "0% 100%", ease: "power2.inOut" },
            0.05
          )
          .to(
            treeGroup,
            { duration: 0.9, scale: 1, transformOrigin: "50% 90%", ease: "elastic.out(1,0.35)" },
            0
          );

        // let particles loop begin
        for (var i = 0; i < particlePool.length; i++) {
          mainTl.add(particlePool[i], 0);
        }
        mainTl.play(0);
      }

      // draw extra stars (little bursts)
      function drawStars() {
        // subtle pulse on star group
        gsap.fromTo(
          starGroup,
          { opacity: 0.2 },
          { opacity: 1, duration: 1.2, repeat: -1, yoyo: true, ease: "sine.inOut" }
        );
      }

      function init() {
        // make sure sizes good
        resizeCanvas();
        initBgStars();
      }

      let init_flag = false;
      // music (use https to avoid mixed content blocking)
      let music_url =
        "https://music.163.com/song/media/outer/url?id=1892513656.mp3";
      let _music = new Audio(music_url);

      function startShow() {
        if (init_flag) return;
        init_flag = true;

        // iOS/Safari requires a user gesture; this is inside a click handler.
        _music.play().catch(function () {
          /* ignore autoplay restrictions */
        });

        init();
        var mask = document.getElementById("mask");
        if (mask) mask.remove();

        createParticles();
        drawStar();
        drawMain();
        mainTl.add(starTl, 0);
        gsap.globalTimeline.timeScale(1.5); // è¶Šå¤§è¶Šå¿«
        drawStars();
      }

      // Prefer clicking the mask, but fall back to body in case the mask is removed/covered.
      var maskEl = document.getElementById("mask");
      if (maskEl) maskEl.addEventListener("click", startShow, { once: true });
      document.body.addEventListener("click", startShow, { once: true });
    </script>
  </body>
</html>
